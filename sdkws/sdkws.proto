// Copyright © 2023 OpenIM. All rights reserved.
//
// Licensed under the Apache License, Version 2.0 (the "License");
// you may not use this file except in compliance with the License.
// You may obtain a copy of the License at
//
//     http://www.apache.org/licenses/LICENSE-2.0
//
// Unless required by applicable law or agreed to in writing, software
// distributed under the License is distributed on an "AS IS" BASIS,
// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
// See the License for the specific language governing permissions and
// limitations under the License.

syntax = "proto3";
package openim.sdkws;

import "wrapperspb/wrapperspb.proto";

option go_package = "github.com/openimsdk/protocol/sdkws";

////////////////////////////////base///////////////////////////////

message GroupInfo {
  string groupID = 1;
  string groupName = 2;
  string notification = 3;
  string introduction = 4;
  string faceURL = 5;
  string ownerUserID = 6;
  int64 createTime = 7;
  uint32 memberCount = 8;
  string ex = 9;
  int32 status = 10;
  string creatorUserID = 11;
  int32 groupType = 12;
  int32 needVerification = 13;
  int32 lookMemberInfo = 14;
  int32 applyMemberFriend = 15;
  int64 notificationUpdateTime = 16;
  string notificationUserID = 17;
}

message GroupInfoForSet {
  string groupID = 1;
  string groupName = 2;
  string notification = 3;
  string introduction = 4;
  string faceURL = 5;
  openim.protobuf.StringValue ex = 6;
  openim.protobuf.Int32Value needVerification = 7;
  openim.protobuf.Int32Value lookMemberInfo = 8;
  openim.protobuf.Int32Value applyMemberFriend = 9;
}

message GroupMemberFullInfo {
  string groupID = 1;
  string userID = 2;
  int32 roleLevel = 3;
  int64 joinTime = 4;
  string nickname = 5;
  string faceURL = 6;
  int32 appMangerLevel = 7; //if >0
  int32 joinSource = 8;
  string operatorUserID = 9;
  string ex = 10;
  int64 muteEndTime = 11;
  string inviterUserID = 12;
}

message PublicUserInfo {
  string userID = 1;
  string nickname = 2;
  string faceURL = 3;
  string ex = 4;
}

message UserInfo {
  string userID = 1;
  string nickname = 2;
  string faceURL = 3;
  string ex = 4;
  int64 createTime = 5;
  int32 appMangerLevel = 6;
  int32 globalRecvMsgOpt = 7;
  string pinyin = 8;
  string status = 9;
  string signature = 10;  // 用户签名
  repeated PlatformDetail onlineStatus = 11; // 平台详细状态列表（包含平台ID和在线状态）
  string jobName = 12;   // 职位名称
  // OA/组织定位字段
  int32 companyID = 13;  // 企业ID
  int32 departmentID = 14;  // 部门ID
  repeated int32 deptPathIDs = 15;  // 部门路径ID数组（从根部门到当前部门的路径，包含根0）
  repeated string deptPathNames = 16;  // 部门路径名称数组（与deptPathIDs一一对应）
  int32 jobTitleID = 17;  // OA职位ID
  // 个人资料字段（不再放入 Ex）
  string areaCode = 18;  // 国家/地区码（如 +86）
  string phoneNumber = 19;  // 手机号
  string email = 20;  // 邮箱
  int32 gender = 21;  // 性别：0=未知/保密，1=男，2=女
  int64 birth = 22;  // 生日时间戳
  string departmentName = 23;  // 部门名称（通常是直属部门名）
  string deptAllName = 24;  // 部门全路径名称
  string jobTitle = 25;  // OA 口径职位
  string workCode = 26;  // 工号
}

// PlatformDetail 平台详细状态信息（与 user.proto 中的 platformDetail 保持一致）
message PlatformDetail {
  int32 platformID = 1;  // 平台ID
  int32 status = 2;      // 该平台的状态：0=离线, 1=在线, 2=离开
}

message UserInfoWithEx {
  string userID = 1;
  openim.protobuf.StringValue nickname = 2;
  openim.protobuf.StringValue faceURL = 3;
  openim.protobuf.StringValue ex = 4;
  openim.protobuf.Int32Value globalRecvMsgOpt = 7;
  openim.protobuf.StringValue pinyin = 8;
  openim.protobuf.StringValue status = 9;
  openim.protobuf.StringValue signature = 10;  // 用户签名
}

message FriendInfo {
  string ownerUserID = 1;
  string remark = 2;
  int64 createTime = 3;
  UserInfo friendUser = 4;
  int32 addSource = 5;
  string operatorUserID = 6;
  string ex = 7;
  bool isPinned = 8;
}

message BlackInfo {
  string ownerUserID = 1;
  int64 createTime = 2;
  PublicUserInfo blackUserInfo = 3;
  int32 addSource = 4;
  string operatorUserID = 5;
  string ex = 6;
}

message GroupRequest {
  PublicUserInfo userInfo = 1;
  GroupInfo groupInfo = 2;
  int32 handleResult = 3;
  string reqMsg = 4;
  string handleMsg = 5;
  int64 reqTime = 6;
  string handleUserID = 7;
  int64 handleTime = 8;
  string ex = 9;
  int32 joinSource = 10;
  string inviterUserID = 11;
}

message FriendRequest {
  string fromUserID = 1;
  string fromNickname = 2;
  string fromFaceURL = 3;
  string toUserID = 4;
  string toNickname = 5;
  string toFaceURL = 6;
  int32 handleResult = 7;
  string reqMsg = 8;
  int64 createTime = 9;
  string handlerUserID = 10;
  string handleMsg = 11;
  int64 handleTime = 12;
  string ex = 13;
}

///////////////////////////////////base end/////////////////////////////////////
enum PullOrder {
  PullOrderAsc = 0;
  PullOrderDesc = 1;
}
message PullMessageBySeqsReq {
  string userID = 1;
  repeated SeqRange seqRanges = 2;
  PullOrder order = 3;
}

message SeqRange {
  string conversationID = 1;
  int64 begin = 2;
  int64 end = 3;
  int64 num = 4;
}

message PullMsgs {
  repeated MsgData Msgs = 1;
  bool isEnd = 2;
  int64 endSeq = 3;
}

message PullMessageBySeqsResp {
  map<string, PullMsgs> msgs = 1;
  map<string, PullMsgs> notificationMsgs = 2;
}

message GetMaxSeqReq {
  string userID = 1;
}

message GetMaxSeqResp {
  map<string, int64> maxSeqs = 1;
  map<string, int64> minSeqs = 2;
}

message UserSendMsgResp {
  string serverMsgID = 1;
  string clientMsgID = 2;
  int64 sendTime = 3;
}

message MsgData {
  string sendID = 1;
  string recvID = 2;
  string groupID = 3;
  string clientMsgID = 4;
  string serverMsgID = 5;
  int32 senderPlatformID = 6;
  string senderNickname = 7;
  string senderFaceURL = 8;
  int32 sessionType = 9;
  int32 msgFrom = 10;
  int32 contentType = 11;
  bytes content = 12;
  int64 seq = 14;
  int64 sendTime = 15;
  int64 createTime = 16;
  int32 status = 17;
  bool isRead = 18;
  map<string, bool> options = 19;
  OfflinePushInfo offlinePushInfo = 20;
  repeated string atUserIDList = 21;
  string attachedInfo = 22;
  string ex = 23;
  LikeInfo likeInfo = 24;
  MarkInfo markInfo = 25;         // 标记信息
}

// 点赞信息
message LikeInfo {
  int64 like_count = 1;
  repeated LikeUser like_users = 2;
}

// 点赞用户信息
message LikeUser {
  string user_id = 1;
  string emojiInfo = 2;
  int64 like_time = 3;
  string nickname = 4;
  string face_url = 5;
}

// 点赞消息提示
message LikeMsgTips {
  string likerUserID = 1;      
  string clientMsgID = 2;   
  int64 likeTime = 3;          
  int64 seq = 4;               
  int32 sessionType = 5;      
  string conversationID = 6;   
  string emojiInfo = 7;        
  int64 likeCount = 8;     
  string LikerNickname = 9;
  string RecvID = 10;
  string LikerFaceURL = 11;
}

// 标记信息结构（存储在消息的 MsgData 中）
message MarkInfo {
  bool isMarked = 1;              // 是否已标记
  string markerUserID = 2;        // 标记人用户ID
  string markerNickname = 3;      // 标记人昵称
  int64 markTime = 4;             // 标记时间（毫秒时间戳）
}

// 消息标记通知提示
message MarkMsgTips {
  string markerUserID = 1;        // 标记人用户ID
  string clientMsgID = 2;         // 客户端消息ID
  int64 markTime = 3;             // 标记时间
  int64 seq = 4;                  // 消息序号
  int32 sessionType = 5;          // 会话类型
  string conversationID = 6;      // 会话ID
  string markerNickname = 7;      // 标记人昵称
  string recvID = 8;              // 接收者ID
  bool isMarked = 9;              // true=标记, false=取消标记
}

message PushMessages {
  map<string, PullMsgs> msgs = 1;
  map<string, PullMsgs> notificationMsgs = 2;
}
message OfflinePushInfo {
  string title = 1;
  string desc = 2;
  string ex = 3;
  string iOSPushSound = 4;
  bool iOSBadgeCount = 5;
  string signalInfo = 6;
}

message TipsComm {
  bytes detail = 1;
  string defaultTips = 2;
  string jsonDetail = 3;
}

//////////////////////group/////////////////////

//	OnGroupCreated()
message GroupCreatedTips {
  GroupInfo group = 1;
  GroupMemberFullInfo opUser = 2;
  repeated GroupMemberFullInfo memberList = 3;
  int64 operationTime = 4;
  GroupMemberFullInfo groupOwnerUser = 5;
  uint64 groupMemberVersion = 6;
  string groupMemberVersionID = 7;
}

//	OnGroupInfoSet()
message GroupInfoSetTips {
  GroupMemberFullInfo opUser = 1; //who do this
  int64 muteTime = 2;
  GroupInfo group = 3;
  uint64 groupMemberVersion = 4;
  string groupMemberVersionID = 5;
}

message GroupInfoSetNameTips {
  GroupMemberFullInfo opUser = 1; //who do this
  GroupInfo group = 2;
  uint64 groupMemberVersion = 3;
  string groupMemberVersionID = 4;
}

message GroupInfoSetAnnouncementTips {
  GroupMemberFullInfo opUser = 1; //who do this
  GroupInfo group = 2;
  uint64 groupMemberVersion = 3;
  string groupMemberVersionID = 4;
}

//	OnJoinGroupApplication()
message JoinGroupApplicationTips {
  GroupInfo group = 1;
  PublicUserInfo applicant = 2;
  string reqMsg = 3;
  string uuid = 4;
  GroupRequest request = 5;
}

//	OnQuitGroup()
//Actively leave the group
message MemberQuitTips {
  GroupInfo group = 1;
  GroupMemberFullInfo quitUser = 2;
  int64 operationTime = 3;
  uint64 groupMemberVersion = 4;
  string groupMemberVersionID = 5;
}

//	OnApplicationGroupAccepted()
message GroupApplicationAcceptedTips {
  GroupInfo group = 1;
  GroupMemberFullInfo opUser = 2;
  string handleMsg = 4;
  int32 receiverAs = 5; // admin(==1) or applicant(==0)
  string uuid = 6;
  GroupRequest request = 7;
}

//	OnApplicationGroupRejected()
message GroupApplicationRejectedTips {
  GroupInfo group = 1;
  GroupMemberFullInfo opUser = 2;
  string handleMsg = 4;
  int32 receiverAs = 5; // admin(==1) or applicant(==0)
  string uuid = 6;
  GroupRequest request = 7;
}

//	OnTransferGroupOwner()
message GroupOwnerTransferredTips {
  GroupInfo group = 1;
  GroupMemberFullInfo opUser = 2;
  GroupMemberFullInfo newGroupOwner = 3;
  string oldGroupOwner = 4;
  int64 operationTime = 5;
  GroupMemberFullInfo oldGroupOwnerInfo = 6;
  uint64 groupMemberVersion = 7;
  string groupMemberVersionID = 8;
}

//	OnMemberKicked()
message MemberKickedTips {
  GroupInfo group = 1;
  GroupMemberFullInfo opUser = 2;
  repeated GroupMemberFullInfo kickedUserList = 3;
  int64 operationTime = 4;
  uint64 groupMemberVersion = 5;
  string groupMemberVersionID = 6;
}

//	OnMemberInvited()
message MemberInvitedTips {
  GroupInfo group = 1;
  GroupMemberFullInfo opUser = 2;
  repeated GroupMemberFullInfo invitedUserList = 3;
  int64 operationTime = 4;
  uint64 groupMemberVersion = 5;
  string groupMemberVersionID = 6;
  GroupMemberFullInfo inviterUser = 7;
}

//Actively join the group
message MemberEnterTips {
  GroupInfo group = 1;
  GroupMemberFullInfo entrantUser = 2;
  int64 operationTime = 3;
  uint64 groupMemberVersion = 5;
  string groupMemberVersionID = 6;
}

message GroupDismissedTips {
  GroupInfo group = 1;
  GroupMemberFullInfo opUser = 2;
  int64 operationTime = 3;
}

message GroupMemberMutedTips {
  GroupInfo group = 1;
  GroupMemberFullInfo opUser = 2;
  int64 operationTime = 3;
  GroupMemberFullInfo mutedUser = 4;
  uint32 mutedSeconds = 5;
  uint64 groupMemberVersion = 6;
  string groupMemberVersionID = 7;
}

message GroupMemberCancelMutedTips {
  GroupInfo group = 1;
  GroupMemberFullInfo opUser = 2;
  int64 operationTime = 3;
  GroupMemberFullInfo mutedUser = 4;
  uint64 groupMemberVersion = 5;
  string groupMemberVersionID = 6;
}

message GroupMutedTips {
  GroupInfo group = 1;
  GroupMemberFullInfo opUser = 2;
  int64 operationTime = 3;
  uint64 groupMemberVersion = 4;
  string groupMemberVersionID = 5;
}

message GroupCancelMutedTips {
  GroupInfo group = 1;
  GroupMemberFullInfo opUser = 2;
  int64 operationTime = 3;
  uint64 groupMemberVersion = 4;
  string groupMemberVersionID = 5;
}

message GroupMemberInfoSetTips {
  GroupInfo group = 1;
  GroupMemberFullInfo opUser = 2;
  int64 operationTime = 3;
  GroupMemberFullInfo changedUser = 4;
  uint64 groupMemberVersion = 5;
  string groupMemberVersionID = 6;
  uint64 groupSortVersion = 7;
}

//////////////////////friend/////////////////////

message FriendApplication {
  int64 addTime = 1;
  string addSource = 2;
  string addWording = 3;
}

message FromToUserID {
  string fromUserID = 1;
  string toUserID = 2;
}

//FromUserID apply to add ToUserID
message FriendApplicationTips {
  FromToUserID fromToUserID = 1; //from: initiator; to: receiver
  FriendRequest request = 2;
}

//FromUserID accept or reject ToUserID
message FriendApplicationApprovedTips {
  FromToUserID fromToUserID = 1; //from: the person who agrees; to: the person who initiates the request
  string handleMsg = 2;
  uint64 friendVersion = 3;
  string friendVersionID = 4;
  FriendRequest request = 5;
}

//FromUserID accept or reject ToUserID
message FriendApplicationRejectedTips {
  FromToUserID fromToUserID = 1; //from: rejecter; to: request initiator
  string handleMsg = 2;
  FriendRequest request = 3;
}

// FromUserID  Added a friend ToUserID
message FriendAddedTips {
  FriendInfo friend = 1;
  int64 operationTime = 2;
  PublicUserInfo opUser = 3; //who do this
  uint64 friendVersion = 4;
  string friendVersionID = 5;
}

// FromUserID  deleted a friend ToUserID
message FriendDeletedTips {
  FromToUserID fromToUserID = 1; //from：owner； to：friend
  uint64 friendVersion = 2;
  string friendVersionID = 3;
}

message BlackAddedTips {
  FromToUserID fromToUserID = 1; //from：owner； to：black
}

message BlackDeletedTips {
  FromToUserID fromToUserID = 1; //from：owner； to：black
}

message FriendInfoChangedTips {
  FromToUserID fromToUserID = 1; //from：changed； to：friend
  uint64 friendVersion = 2;
  string friendVersionID = 3;
  uint64 friendSortVersion = 4;
}

//////////////////////user/////////////////////
message UserInfoUpdatedTips {
  string userID = 1;
}

message UserStatusChangeTips {
  string fromUserID = 1;
  string toUserID = 2;
  int32 status = 3;
  int32 platformID = 4;
}
message UserCommandAddTips {
  string fromUserID = 1;
  string toUserID = 2;
}
message UserCommandUpdateTips {
  string fromUserID = 1;
  string toUserID = 2;
}
message UserCommandDeleteTips {
  string fromUserID = 1;
  string toUserID = 2;
}

message UserEmojiAddTips {
  string fromUserID = 1;
  string toUserID = 2;
}

message UserEmojiDeleteTips {
  string fromUserID = 1;
  string toUserID = 2;
}

// 快捷回复刷新完成通知（常用回复统计完成后发送）
message UserQuickReplyUpdateTips {
  string fromUserID = 1;
  string toUserID = 2;
  int64 refreshTime = 3;  // 刷新时间
}

// AI快捷回复更新通知（AI生成完成后发送）
message UserAIQuickReplyUpdateTips {
  string fromUserID = 1;
  string toUserID = 2;
  int64 updateTime = 3;  // 更新时间
}

// 快捷回复新增通知
message UserQuickReplyAddTips {
  string fromUserID = 1;
  string toUserID = 2;
  string replyID = 3;     // 回复ID
  string content = 4;     // 回复内容
  int32 replyType = 5;    // 回复类型
}

// 快捷回复删除通知
message UserQuickReplyDeleteTips {
  string fromUserID = 1;
  string toUserID = 2;
  string replyID = 3;     // 回复ID
}

// 快捷回复修改通知
message UserQuickReplyModifyTips {
  string fromUserID = 1;
  string toUserID = 2;
  string replyID = 3;     // 回复ID
  string content = 4;     // 回复内容
}

// 快捷回复置顶/取消置顶通知
message UserQuickReplyPinTips {
  string fromUserID = 1;
  string toUserID = 2;
  string replyID = 3;     // 回复ID
  bool isPinned = 4;      // 是否置顶
  int64 pinTime = 5;      // 置顶时间
}

// 智能总结记录新增通知（通知群成员或单聊对方）
message SummaryRecordAddTips {
  string operatorUserID = 1;     // 操作者用户ID（创建总结的人）
  string conversationID = 2;     // 会话ID
  int32 conversationType = 3;    // 会话类型：1=单聊，2=群聊
  string summaryID = 4;          // 总结记录ID
  string title = 5;              // 总结标题
  string overview = 6;           // 总结概述
  int64 createTime = 7;          // 创建时间
  string creatorNickname = 8;    // 创建者昵称
  string creatorFaceURL = 9;     // 创建者头像
  string contents = 10;          // 用户输入的总结请求
  int32 summaryType = 11;        // 总结类型：1=自动生成，2=手动生成
}

// 智能总结记录删除通知
message SummaryRecordDeleteTips {
  string operatorUserID = 1;     // 操作者用户ID
  string conversationID = 2;     // 会话ID
  int32 conversationType = 3;    // 会话类型
  string summaryID = 4;          // 被删除的总结记录ID
}

// 智能总结记录收藏状态变更通知
message SummaryRecordFavoriteTips {
  string operatorUserID = 1;     // 操作者用户ID
  string summaryID = 2;          // 总结记录ID
  bool isFavorite = 3;           // 是否收藏
}

// 智能总结记录发布通知（多端同步）
message SummaryRecordPublishTips {
  string operatorUserID = 1;     // 操作者用户ID
  string summaryID = 2;          // 总结记录ID
}

//////////////////////conversation/////////////////////
message ConversationUpdateTips {
  string userID = 1;
  repeated string conversationIDList = 2;
}

message ConversationSetPrivateTips {
  string recvID = 1;
  string sendID = 2;
  bool isPrivate = 3;
  string conversationID = 4;
}

message ConversationHasReadTips {
  string userID = 1;
  string conversationID = 2;
  int64 hasReadSeq = 3;
  int64 unreadCountTime = 4;
}

message NotificationElem {
  string detail = 1;
}

////////////////////message///////////////////////
message seqs {
  repeated int64 seqs = 1;
}

message DeleteMessageTips {
  string opUserID = 1;
  string userID = 2;
  repeated int64 seqs = 3;
}

message RevokeMsgTips {
  string revokerUserID = 1;
  string clientMsgID = 2;
  int64 revokeTime = 3;
  int32 sesstionType = 5;
  int64 seq = 6;
  string conversationID = 7;
  bool isAdminRevoke = 8;
}

message MessageRevokedContent {
  string revokerID = 1;
  int32 revokerRole = 2;
  string clientMsgID = 3;
  string revokerNickname = 4;
  int64 revokeTime = 5;
  int64 sourceMessageSendTime = 6;
  string sourceMessageSendID = 7;
  string sourceMessageSenderNickname = 8;
  int32 sessionType = 10;
  int64 seq = 11;
  string ex = 12;
}

message ClearConversationTips {
  string userID = 1;
  repeated string conversationIDs = 2;
}

message DeleteMsgsTips {
  string userID = 1;
  string conversationID = 2;
  repeated int64 seqs = 3;
}

message MarkAsReadTips {
  string markAsReadUserID = 1;
  string conversationID = 2;
  repeated int64 seqs = 3;
  int64 hasReadSeq = 4;
}

// 群消息已读成员信息
message GroupMsgReadUser {
  string userID = 1;        // 用户ID
  string nickname = 2;      // 昵称
  string faceURL = 3;       // 头像URL
  int64 readTime = 4;       // 已读时间（毫秒时间戳）
  bool isRead = 5;          // 是否已读
  string signature = 6;     // 用户签名
}

message SetAppBackgroundStatusReq {
  string userID = 1;
  bool isBackground = 2;
}

message SetAppBackgroundStatusResp {}
message ProcessUserCommand {
  string userID = 1;
  int32 type = 2;
  int64 createTime = 3;
  string uuid = 4;
  string value = 5;
}

message RequestPagination {
  int32 pageNumber = 1;
  int32 showNumber = 2;
}
message FriendsInfoUpdateTips {
  FromToUserID fromToUserID = 1;
  repeated string friendIDs = 2;
  uint64 friendVersion = 3;
  string friendVersionID = 4;
}

message SubUserOnlineStatusElem {
  string userID = 1;
  repeated int32 onlinePlatformIDs = 2;
  map<int32, int32> platformDetails = 3;  // 平台详细状态 platformID -> status
}

message SubUserOnlineStatusTips {
  repeated SubUserOnlineStatusElem subscribers = 1;
}

message SubUserOnlineStatus {
  repeated string subscribeUserID = 1;
  repeated string unsubscribeUserID = 2;
}

message StreamMsgTips {
  string conversationID = 1;
  string clientMsgID = 2;
  int64 startIndex = 3;
  repeated string packets = 4;
  bool end = 5;
}

message ConversationDeleteTips {
  string userID = 1;
  repeated string conversationIDs = 2;
}

message ConversationGroupChangeTips {
  string userID = 1;
  string groupID = 2;
  string action = 3;
  string groupName = 4;
  repeated string conversationIDs = 5;
  int64 updateTime = 6;
}

// 折叠组统一通知（包含创建、更新、删除、会话移入/移出操作）
message ConversationFoldNotificationTips {
  string userID = 1;                    // 用户ID
  string foldConversationID = 2;        // 折叠会话ID
  string action = 3;                    // 操作类型: "created"=创建, "updated"=更新, "deleted"=删除, "conversation_added"=会话移入, "conversation_removed"=会话移出
  string conversationID = 4;            // 变更的会话ID（会话移入/移出时使用）
  string foldName = 5;                  // 折叠名称（创建/更新时）
  int32 foldType = 6;                   // 折叠类型: 1=普通折叠, 2=通知折叠（创建时）
  string faceURL = 7;                   // 头像URL（更新时）
  string description = 8;               // 描述（更新时）
  int64 timestamp = 9;                  // 时间戳（创建/更新/删除/移入/移出时间）
}

